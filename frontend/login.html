<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Login - Lunchify</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    overflow: hidden;
}

/* Image de fond */
body::before {
    content: "";
    position: absolute;
    inset: 0;
    background: 
        linear-gradient(135deg, rgba(249,115,22,0.75), rgba(251,146,60,0.65)),
        url("https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1974&auto=format&fit=crop");
    background-size: cover;
    background-position: center;
    z-index: -1;
}

.card {
    background:white;
    padding:40px;
    border-radius:20px;
    width:350px;
    box-shadow:0 10px 40px rgba(0,0,0,0.15);
}

h2 {
    margin-bottom:20px;
}

input {
    width:100%;
    padding:12px;
    margin:10px 0;
    border-radius:10px;
    border:1px solid #e5e7eb;
}

button {
    width:100%;
    padding:12px;
    border:none;
    border-radius:10px;
    background:#f97316;
    color:white;
    font-weight:600;
    cursor:pointer;
    margin-top:10px;
}

button:hover {
    background:#ea580c;
}

.error {
    color:red;
    font-size:14px;
}
</style>
</head>

<body>

<div class="card">
    <h2>üçΩ Lunchify</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Mot de passe">
    <button onclick="login()">Se connecter</button>
    <div class="error" id="error"></div>
</div>

<script>
async function login() {

    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const formData = new URLSearchParams();
    formData.append("username", email);
    formData.append("password", password);

    const response = await fetch("http://127.0.0.1:8000/login", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
        email: email,
        password: password
    })
});
    const data = await response.json();

    if (data.access_token) {

        localStorage.setItem("token", data.access_token);

        // r√©cup√©rer le profil utilisateur
        const meResponse = await fetch("http://127.0.0.1:8000/me", {
            headers: {
                "Authorization": "Bearer " + data.access_token
            }
        });

        const user = await meResponse.json();
        localStorage.setItem("role", user.role);

        window.location.href = "home.html";

    } else {
        document.getElementById("error").innerText = "Identifiants invalides";
    }
}
</script>
</script>

</body>
</html>